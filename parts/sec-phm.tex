% Enrichissement avec simultanéité des actions :
\section{Frappes de Processus avec actions plurielles}
\seclabel{phm}

Il peut être intéressant de vouloir représenter un système au niveau de ses réactions biochimiques,
c'est-à-dire des réactions entre les différents composants présents.
De telles réactions peuvent avoir différentes formes (transformation, complexation, dissociation...),
et il est fréquent qu'elles fassent intervenir plusieurs réactifs et plusieurs produits.
Biocham \todo{ref} propose par exemple de modéliser un tel système de réactions biochimiques à l'aide
d'un ensemble de règles de réaction de la forme :
$X \xrightarrow{Y} Z$,
ou encore :
$X + Y \rightarrow Y + Z$,
où $X$ est un ensemble de réactifs, $Y$ un ensemble de catalyseurs et $Z$ un ensemble de produits.

Les \emph{Frappes de Processus avec actions plurielles} permettent de représenter de telles réactions
mettant en jeu un nombre arbitraire de réactifs, de produits et de catalyseurs.
Ainsi, une réaction de la forme : $X \xrightarrow{Y} Z$
peut être représentée à l'aide de l'action $\PHfrappemult{A}{B}$
où $A$ et $B$ sont deux ensembles des processus,
$A$ regroupant tous les processus représentant les composants nécessaires à initier la réaction,
et $B$ tous les processus qui ont évolué pendant la réaction.
%$A$ regroupant tous les processus permettant de représenter les composants de $X \cup Y$,
%et $B$ ceux de $Z$.
Une telle action peut donc être jouée dans un état contenant tous les processus de $A$
%(c'est-à-dire les réactifs et les catalyseurs)
et fait évoluer celui-ci vers un état contenant tous les processus de $B$, % (les produits),
les autres processus restant inchangés. % (car n'intervenant pas ou en tant que catalyseurs).
Cela implique toutefois que pour tout processus de $B$, il existe un autre processus de la même
sorte dans $A$.
Les Frappes de Processus avec actions plurielles permettent donc de représenter
un nombre arbitraire de bonds simultanés
---~autrement dit, de changements simultanés de processus actifs~---
déclenchés par un nombre arbitraire de requis
---~sous la forme de processus actifs .

Un parallèle peut être tracé d'une part entre $A$ et l'ensemble des réactifs et catalyseurs,
et d'autre part entre $B$ et l'ensemble des produits.
Cependant, la modélisation par Frappes de Processus avec actions plurielles
nécessite aussi de donner explicitement les composants sont absents.
Par exemple, une réaction de complexation du type : $x + y \rightarrow c$ %x\!\!-\!\!y$
sera représentée en Frappes de Processus avec actions plurielles par trois sortes de deux processus
$x$, $y$ et $c$ représentant respectivement les deux réactifs et le complexe produit,
et par l'action $\PHfrappemults{x_1, y_1, c_0}{x_0, y_0, c_1}$.
%si on ne prend pas en compte la disparition des réactifs.
Autrement dit, il est nécessaire de décomposer chaque élément en fonction de sa présence
($x_1$ et $y_1$)
ou de son absence ($c_0$) au début comme à la fin de la réaction,
et pas uniquement d'indiquer les composants présents en tant que réactifs ou produits.

On note ainsi qu'une réaction de la forme $\PHfrappemult{\{ a_0, b_0, c_0 \}}{\{ a_1, b_1 \}}$
ne peut être jouée si l'une des deux sortes entrant en jeu, $a$ et $b$, est déjà au niveau $1$,
même si l'autre est au niveau $0$.
Un tel comportement a du sens lorsque les différents processus d'une sorte
($a_0$ et $a_1$, par exemple)
représentent différents états d'une même molécule :
la réaction ne peut alors pas être jouée pour des raisons de stœchiométrie.
Cependant, si ces différents processus représentent plutôt des niveaux de concentration
($a_1$ représentant par exemple un niveau de concentration de la molécule $a$ plus élevé que $a_0$),
cette restriction n'a plus de sens car une plus forte concentration d'une des entités
ne devrait pas empêcher la réaction d'avoir lieu et de produire la seconde entité.
Cela peut néanmoins être corrigé en ajoutant les actions
$\PHfrappemult{\{ a_1, b_0, c_0 \}}{\{ a_1, b_1 \}}$ et
$\PHfrappemult{\{ a_0, b_1, c_0 \}}{\{ a_1, b_1 \}}$,
ou encore en séparant la production de $a_1$ et de $b_1$ en deux actions (ou ensemble d'actions)
distinctes.

Cette forme des Frappes de Processus peut être aisément représentée à l'aide d'un réseau
d'automates synchronisés, chaque sorte ayant le rôle d'un automate et chaque action celui d'un
ensemble de transitions étiquetées avec le même libellé partant chacune d'un processus dans $A$ et
arrivant dans le processus de la même sorte dans $A \recouvre B$,
comme décrit à la \secref{phm2an}.
On peut aussi la représenter à l'aide de Frappes de Processus avec 4 classes de priorités,
comme détaillé à la \secref{phm2php} ;
cependant, cette représentation a l'inconvénient d'être moins claire car faisant intervenir
un nombre important d'actions et de sortes supplémentaires.

\todo{Schéma exemple}



\subsection{Définition}

\todo{Gluer}

\todo{$A \in \Proc$ ?}

\begin{definition}[Frappes de Processus avec actions plurielles]
\deflabel{phm}
  Les \emph{Frappes de Processus avec actions plurielles} sont définies
  par un triplet $\PH = (\PHs; \PHl; \PHh)$, où :
  \begin{itemize}
    \item $\PHs \DEF \{a, b, \dots\}$ est l'ensemble fini et dénombrable des \emph{sortes} ;
    \item $\PHl \DEF \bigtimes{a \in \PHs} \PHl_a$ est l'ensemble fini des \emph{états},
      où $\PHl_a = \{a_0, \ldots, a_{l_a}\}$ est l'ensemble fini et dénombrable
      des \emph{processus} de la sorte $a \in \PHs$ et $l_a \in \sN^*$.
      Chaque processus appartient à une unique sorte :
      $\forall (a_i; b_j) \in \PHl_a \times \PHl_b, a \neq b \Rightarrow a_i \neq b_j$ ;
    \item $\PHh \DEF \{\PHfrappemult{A}{B} \mid A, B \in \PHsublset \setminus \emptyset \wedge
      \forall q \in B, \exists p \in A, (p \neq q \wedge \PHsort(p) = \PHsort(q)) \}$
      est l'ensemble fini des \emph{actions}.
  \end{itemize}
\end{definition}
%
\noindent
Pour toute action $h = \PHfrappemult{A}{B} \in \PHh$,
$A$ est appelé le \emph{frappeur} et $B$ le \emph{bond} de $h$,
et on note : $\hitter{h} = A$, $\bounce{h} = B$.
On note de plus :
$\target{h} = \{ p \in A \mid \exists q \in B, \PHsort(p) = \PHsort(q) \}$.

\begin{definition}[Opérateur de jouabilité ($\Fopsymbol_\Fopphmsubsymbol : \PHh \rightarrow \F$)]
\deflabel{fopphm}
  L'opérateur de jouabilité des Frappes de Processus avec actions plurielles est défini par :
  \[\forall h \in \PHh, \Fopphm{h} \equiv \bigwedge_{p \in \hitter{h}} p \enspace.\]
\end{definition}



\subsection{Équivalence avec les réseaux d'automates synchronisés}
\seclabel{phm2an}

\todo{Définition des RAS (def + dynamique)}

\todo{Glu}

%On note $\phmtoan$ le réseau d'automates synchronisés équivalent aux frappes de processus $\PH$,
%défini par :

\begin{definition}[Automate équivalent ($\phmtoansymbol$)]
\deflabel{phm2an}
  Le réseau d'automates équivalent aux Frappes de Processus avec actions plurielles $\PH$
  est défini par : $\phmtoan = (\PHs, \PHl, \ANi, \ANt)$, où :
  \begin{itemize}
    \item $\ANi = \{ \ell_h \mid h \in \PHh \}$ est l'ensemble des libellés de transitions ;
    \item $\ANt = \{ p \xrightarrow{\ell_h} q \mid
      h \in \PHh \wedge h = \PHfrappemult{A}{B} \wedge p \in A \wedge q \in A \recouvre B \wedge
      \PHsort(p) = \PHsort(q) \}$ est l'ensemble des transitions locales.
  \end{itemize}
\end{definition}

\begin{theorem}[$\PH \approx \phmtoan$]
\thmlabel{phmequivan}
  \[\forall s, s' \in \PHl, s \PHtrans s' \Longleftrightarrow s \trans{\phmtoan} s' \enspace.\]
\end{theorem}

\todo{Preuve}

\todo{Sens ($\Leftarrow$) !}



\subsection{Équivalence avec les Frappes de Processus avec 4 classes de priorités}
\seclabel{phm2php}

Nous proposons dans cette section une traduction des Frappes de Processus
avec actions plurielles en Frappes de Processus avec 4 classes de priorités (\defref{phm2php})
et nous montrons que les modèles obtenus de cette façon sont faiblement bisimilaires
(\thmref{phmbisimphp}).
Nous en déduisons que ces deux formalismes ont une expressivité équivalente,
%(\thmref{phmequivphp}).
car les Frappes de Processus avec 4 classes de priorités peuvent à leur tour être
traduites en Frappes de Processus canoniques (comme expliqué à la \secref{phm-aplatissement}),
celles-ci pouvant à leur tour être traduites en Frappes de Processus avec actions plurielles
\TODO.

La traduction proposée permet d'obtenir un modèle de
Frappes de Processus pseudo-canoniques avec 4 classes de priorités,
telles que définies plus tard, à la \secref{phcanonique}.
De façon informelle, ce modèle comporte 4 classes de priorités
et repose sur l'utilisation de deux types de sortes particulières :
\begin{itemize}
  \item des sortes coopératives pour vérifier la présence de tous les processus du frappeur,
  \item des \emph{sortes de réaction} permettant de modéliser le déclenchement d'une \emph{réaction},
    ou son arrêt.
\end{itemize}
Une réaction modélise le fait qu'un ensemble d'actions est en train
de simuler le jeu d'une action plurielle.
À toute action plurielle $h$ du modèle d'origine correspond une sorte coopérative $\scf{h}$
entre les sortes des processus de $A$
et une sorte de réaction $\sr{h}$ dans le modèle résultant de cette traduction.
La sorte coopérative comporte notamment un processus $\scf{h}_\mypi$ qui représente le sous-état
où tous les processus de $A$ sont présents ; une action de priorité 4 de la forme
$\PHhit{\scf{h}_\mypi}{\sr{h}_0}{\sr{h}_1}$ permet d'activer la sorte de réaction.
Une auto-action de priorité 3 de la forme $\PHhit{\sr{h}_1}{\sr{h}_1}{\sr{h}_0}$
permet de plus la désactivation de la sorte de réaction
une fois que toutes les actions de priorité 2 auront été jouées.
Les actions de priorité 2 ont la forme $\PHhit{\sr{h}_1}{b_j}{b_k}$
avec $b_j \in A$ et $b_k \in B$,
ce qui permet d'effectuer tous les bonds nécessaires à l'activation des processus de $B$.
Enfin, les sortes coopératives sont toutes mises à jour par des actions de priorité 1,
afin d'éviter les problèmes d'entrelacement
et de correspondre à la définition de Frappes de Processus pseudo-canoniques
(\defref{phpseudocanonique})
L'agencement de ces classes de priorités permet ainsi de simuler des actions plurielles
tout en empêchant l'entrelacement entre réactions
---~car deux réactions ayant lieu en même temps pourraient potentiellement
amener le système dans un état normalement inaccessible.

\begin{definition}
\deflabel{phm2php}
  Soient $\PH = (\PHs; \PHl; \PHh)$ des Frappes de Processus avec actions plurielles,
  et $\phmtophp = (\PHs'; \PHl'; \PHh'^{\langle 4 \rangle})$
  leur traduction en Frappes de Processus avec $4$ classes de priorités, où :
  \begin{itemize}
    \item $\PHs' = \PHs \cup \{ \sr{h} \mid h \in \PHh \} \cup \{ \scf{h} \mid h \in \PHh \}$ ;
    \item $\PHl' = \PHl \times \left( \bigtimes{h \in \PHh} \PHl_{\sr{h}} \right)
      \times \left( \bigtimes{h \in \PHh} \PHl_{\scf{h}} \right)$, où :
      \begin{itemize}
        \item $\forall h \in \PHh, \PHl_{\sr{h}} = \{ \sr{h}_0 , \sr{h}_1 \}$,
        \item $\forall h \in \PHh, \PHl_{\scf{h}} = \{ \scf{h}_\mysigma \mid
          \mysigma \in \PHsubl_{\sortes{\frappeur{h}}} \}$ ;
      \end{itemize}
    \item $\PHh'^{\langle 4 \rangle} = ( \PHh'^{(1)} ; \PHh'^{(2)} ; \PHh'^{(3)} ; \PHh'^{(4)} )$, où :
      \begin{itemize}
        \item $\PHh'^{(1)} = \{ \PHhit{a_i}{\scf{h}_\mysigma}{\scf{h}_{\mysigma'}} \mid
          h \in \PHh \wedge a \in \sortes{\frappeur{h}} \wedge a_i \in \PHl_a \wedge
          \scf{h}_\mysigma , \scf{h}_{\mysigma'} \in \PHl_{\scf{h}} \wedge
          \PHget{\mysigma}{a} \neq a_i \wedge \mysigma' = \mysigma \Cap a_i \}$,
        \item $\PHh'^{(2)} = \{ \PHhit{\sr{h}_1}{b_j}{b_k} \mid
          h \in \PHh \wedge b \in \sortes{\bond{h}} \wedge b_j, b_k \in \PHl_b \wedge
          b_j \in \frappeur{h} \wedge b_k \in \cible{h} \}$,
        \item $\PHh'^{(3)} = \{ \PHhit{\sr{h}_1}{\sr{h}_1}{\sr{h}_0} \mid h \in \PHh \}$,
        \item $\PHh'^{(4)} = \{ \PHhit{\scf{h}_\mypi}{\sr{h}_0}{\sr{h}_1} \mid
          h \in \PHh \wedge \Feval{\Fopphm{h}}{\mypi} \}$.
      \end{itemize}
  \end{itemize}
  Pour tout état $s \in \PHl$ de $\PH$,
  on note $\tophp{s}$ l'état correspondant dans $\phmtophp$ :
  \begin{itemize}
    \item $\forall a \in \PHs, \PHget{\tophp{s}}{a} = \PHget{s}{a}$,
    \item $\forall h \in \PHh, \PHget{\tophp{s}}{\sr{h}} = \sr{h}_0$,
    \item $\forall h \in \PHh, \PHget{\tophp{s}}{\scf{h}} = \scf{h}_\mysigma$,
      tel que $\forall a \in \sortes{\frappeur{h}}, \PHget{\mysigma}{a} = \PHget{\tophp{s}}{a}$.
  \end{itemize}
  À l'inverse, pour tout état $s' \in \PHl'$ de $\phmtophp$,
  on note $\tophm{s'}$ l'état correspondant dans $\PH$ :
  $\forall a \in \PHs, \PHget{\tophm{s'}}{a} = \PHget{s'}{a}$.
\end{definition}

\begin{theorem}[$\PH \approx \phmtophp$]
\thmlabel{phmbisimphp}
  \[\forall s_1, s_2 \in \PHl, s \PHtrans s' \Longleftrightarrow
    \tophp{s_1} \trans{\phmtophp} \tophp{s_2} \enspace.\]
\end{theorem}




\todo{Preuve}

\todo{Formaliser l'équivalence PHplurielles / PHp de façon formelle ?}

% \begin{theorem}[Équivalence]
% \thmlabel{phmequivphp}
%   Les Frappes de Processus avec actions plurielles
%   et les Frappes de Processus avec $k$ classes de priorités
%   ont une expressivité équivalente.
% \end{theorem}
% 
% \begin{proof}
%   D'après \thmref{phmbisimphp} d'une part,
%   et d'après \todo{ref trad PHcanonique} d'autre part,
%   la traduction de \todo{PHcanonique} vers les Frappes de Processus avec actions plurielles
%   étant triviale.
% \end{proof}



\subsection{Réutilisation des outils existants}
\seclabel{phm-outils}

\todo{Revoir le titre de cette section}

\todo{Faudrait-il fusionner cette section avec ses semblables des \secref{php} et \secref{phan} ?}

\subsubsection{Points fixes}
\seclabel{phm-outils-pf}

Du fait de la complexité des actions plurielles, il n'existe pas à l'heure actuelle de méthode
générique efficace permettant de déduire les points fixes de Frappes de Processus avec
actions plurielles.
Cependant, à l'instar des Frappes de Processus avec arcs neutralisants
(\secref{phan-outils-pf})
il est possible d'obtenir ces points fixes les cherchant sur
le modèle aplati (tel que défini à la \secref{phm-aplatissement}).
En effet, sa dynamique étant équivalente, aux sortes coopératives près, le résultat
peut être transposé au modèle d'origine.

\subsubsection{Analyse statique}
\seclabel{phm-outils-as}

Du fait de la forme particulière des actions, les méthodes d'analyse statique ne s'appliquent pas
directement aux Frappes de Processus avec actions plurielles.
Cependant, moyennant l'utilisation de la traduction vers des Frappes de Processus
avec 4 classes de priorités donnée à la \defref{phm2php},
il est possible de les appliquer sur un modèle équivalent.

\subsubsection{Paramètres stochastiques}
\seclabel{phm-outils-stocha}

Il est théoriquement possible d'associer des paramètres stochastiques à chaque action plurielle
d'un modèle de Frappes de Processus avec actions plurielles.
Un tel ajout aurait notamment l'avantage d'éviter l'utilisation de la valeur «~infinie~»
d'absorption de stochasticité, qui avait principalement pour but de simuler des actions
successives instantanées, afin notamment de pallier le fait qu'un seul processus
ne peut évoluer pour chaque jeu d'action des Frappes de Processus standards.

Une autre alternative consisterait à utiliser l'aplatissement de la \secref{phm-aplatissement},
et d'attribuer aux actions correspondant à des activations de réaction
dans le modèle obtenu les paramètres stochastiques voulus.
