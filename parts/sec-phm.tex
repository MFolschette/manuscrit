\section{Enrichissement avec simultanéité des actions : Frappes de Processus avec actions plurielles}
\seclabel{phm}

\todo{Introduction}

Les Frappes de Processus avec actions plurielles permettent de représenter des systèmes
de réactions biochimiques de la forme : $X + Y \rightarrow Y + Z$,
c'est-à-dire comportant un ensemble de réactifs $X$, un ensemble de catalyseurs $Y$
et un ensemble de produits $Z$.
La représentation d'une telle réaction en Frappes de Processus avec actons plurielles
aura la forme suivante :
$\PHfrappemult{A}{B}$ où $A = X \cup Y$ et $B = Z$,
où $A$ et $B$ sont des ensembles des processus.

Une telle action peut donc être jouée dans un état contenant tous les processus de $A$
(c'est-à-dire les réactifs et les catalyseurs)
et fait évoluer celui-ci vers un état contenant tous les processus de $B$ (les produits),
les autres processus restant inchangés (car n'intervenant pas ou en tant que catalyseurs).
Cela implique toutefois que pour tout processus de $B$, on trouve un autre processus de la même
sorte dans $A$.

On note cependant qu'une réaction de la forme $\PHfrappemult{\{ a_0, b_0, c_0 \}}{\{ a_1, b_1 \}}$
ne peut être jouée si l'une des deux sortes entrant en jeu, $a$ et $b$, est déjà au niveau $1$,
même si l'autre est au niveau $0$.
Un tel comportement a du sens lorsque les différents processus d'une sorte
($a_0$ et $a_1$, par exemple)
représentent différents états d'une même molécule :
la réaction ne peut alors pas être jouée pour des raisons de stœchiométrie.
Cependant, si ces différents processus représentent plutôt des niveaux de concentration
($a_1$ représentant par exemple un niveau de concentration de la molécule $a$ plus élevé que $a_0$),
cette restriction n'a plus de sens car une plus forte concentration d'une des entités
ne devrait pas empêcher la réaction d'avoir lieu et de produire la seconde entité.
Cela peut néanmoins être corrigé en ajoutant les actions
$\PHfrappemult{\{ a_1, b_0, c_0 \}}{\{ a_1, b_1 \}}$ et
$\PHfrappemult{\{ a_0, b_1, c_0 \}}{\{ a_1, b_1 \}}$,
ou encore en séparant la production de $a_1$ et de $b_1$ en deux actions (ou ensemble d'actions)
distinctes.

On peut utiliser les Frappes de Processus avec actions plurielles pour représenter toute simultanéité
entre les bonds ou entre les processus requis (aussi appelés frappeurs).
Elle est particulièrement adaptée à la forme des réactions biochimiques,
comme expliqué ci-dessus.

Cette forme des Frappes de Processus peut être aisément représentée à l'aide d'un réseau
d'automates synchronisés, chaque sorte ayant le rôle d'un automate et chaque action celui d'un
ensemble de transition étiquetées avec le même libellé partant chacune d'un processus dans $A$ et
arrivant dans le processus de la même sorte dans $A \recouvre B$,
comme décrit à la \secref{phm2an}.
On peut aussi la représenter à l'aide de Frappes de Processus avec 4 classes de priorités,
comme détaillé à la \secref{phm2php} ;
cependant, cette représentation a l'inconvénient d'être moins claire car faisant intervenir
un nombre important d'actions et de sortes supplémentaires.



\subsection{Définition}

\todo{Gluer}

\begin{definition}[Frappes de Processus avec actions plurielles]
\deflabel{phm}
  Les \emph{Frappes de Processus avec actions plurielles} sont définies
  par un triplet $\PH = (\PHs; \PHl; \PHh)$, où :
  \begin{itemize}
    \item $\PHs \DEF \{a, b, \dots\}$ est l'ensemble fini et dénombrable des \emph{sortes} ;
    \item $\PHl \DEF \bigtimes{a \in \PHs} \PHl_a$ est l'ensemble fini des \emph{états},
      où $\PHl_a = \{a_0, \ldots, a_{l_a}\}$ est l'ensemble fini et dénombrable
      des \emph{processus} de la sorte $a \in \PHs$ et $l_a \in \sN^*$.
      Chaque processus appartient à une unique sorte :
      $\forall (a_i; b_j) \in \PHl_a \times \PHl_b, a \neq b \Rightarrow a_i \neq b_j$ ;
    \item $\PHh \DEF \{\PHfrappemult{A}{B} \mid A, B \in \PHsublset \setminus \emptyset \wedge
      \forall q \in B, \exists p \in A, (p \neq q \wedge \PHsort(p) = \PHsort(q)) \}$
      est l'ensemble fini des \emph{actions}.
  \end{itemize}
\end{definition}
%
\noindent
Pour toute action $h = \PHfrappemult{A}{B} \in \PHh$,
$A$ est appelé le \emph{frappeur}, et $b_k$ le \emph{bond} de $h$,
et on note : $\hitter{h} = A$, $\bounce{h} = B$.
On note de plus :
$\target{h} = \{ p \in A \mid \exists q \in B, \PHsort(p) = \PHsort(q) \}$.

\begin{definition}[Opérateur de jouabilité ($\Fopsymbol_\Fopphmsubsymbol : \PHh \rightarrow \F$)]
\deflabel{fopphm}
  L'opérateur de jouabilité des Frappes de Processus avec actions plurielles est défini par :
  \[\forall h \in \PHh, \Fopphm{h} \equiv \bigwedge_{p \in \hitter{h}} p \enspace.\]
\end{definition}



\subsection{Équivalence avec les automates synchronisés}
\seclabel{phm2an}

\todo{Gluer}
On note $\phmtoan$ l'automate équivalent aux frappes de processus $\PH$, défini par :

\begin{definition}[Automate équivalent ($\phmtoansymbol$)]
\deflabel{phm2an}
  Le réseau d'automates équivalent aux Frappes de Processus avec actions plurielles $\PH$
  est défini par : $\phmtoan = (\PHs, \PHl, \ANi, \ANt)$, où :
  \begin{itemize}
    \item $\ANi = \{ \ell_h \mid h \in \PHh \}$ est l'ensemble des libellés de transitions ;
    \item $\ANt = \{ p \xrightarrow{\ell_h} q \mid
      h \in \PHh \wedge h = \PHfrappemult{A}{B} \wedge p \in A \wedge q \in A \recouvre B \wedge
      \PHsort(p) = \PHsort(q) \}$ est l'ensemble des transitions locales.
  \end{itemize}
\end{definition}

\todo{Définir la dynamique des réseaux d'automates}

\begin{theorem}[$\PH \approx \phmtoan$]
\thmlabel{phmequivan}
  \[\forall s, s' \in \PHl, s \PHtrans s' \Longleftrightarrow s \trans{\phmtoan} s' \enspace.\]
\end{theorem}

\todo{Preuve}



\subsection{Équivalence avec les Frappes de Processus avec 4 classes de priorités}
\seclabel{phm2php}

\begin{comment}
\newcommand{\phmtophan}{\mathsf{phm2phan}}
\newcommand{\srsymbol}{r}
\newcommand{\sr}[1]{\srsymbol^{#1}}
\newcommand{\srgsymbol}{R}
\newcommand{\srg}{\srgsymbol}
\newcommand{\scfsymbol}{f}
\newcommand{\scf}[1]{\scfsymbol^{(#1)}}
\newcommand{\scfa}{\scf{A}}
\newcommand{\scfb}{\scf{A \recouvre B}}

\newcommand{\PHssr}[1][\PHs']{#1_{\srsymbol}}
\newcommand{\PHsscfa}[1][\PHs']{#1^A_{\scfsymbol}}
\newcommand{\PHsscfb}[1][\PHs']{#1^B_{\scfsymbol}}

\newcommand{\PHhsr}[1][\PHh']{#1_{\srsymbol}}
\newcommand{\PHhscfa}[1][\PHh']{#1^A_{\scfsymbol}}
\newcommand{\PHhscfb}[1][\PHh']{#1^B_{\scfsymbol}}

\begin{definition}[Représentation avec arcs neutralisants]
\deflabel{phm2phan}
  On note : $\forall A \in \PHsublset, \lozsc{x}{A} =
  \{ \mysc{x}{A}_\mysigma \mid \mysigma \in \PHsubl_{\sortes{A}} \}$
  où $\sortes{A} = \{ \sorte{p} \mid p \in A \}$.
  De plus, on note : $\mysc{x}{A}_\mypi \in \lozsc{x}{A}$
  le processus tel que $\Feval{\Fconj{A}}{\mypi}$.

  Soit $\PH = (\PHs; \PHl; \PHh)$ et $\phmtophan(\PH) = (\PHs'; \PHl'; \PHh'; \PHn')$
  sa traduction en Frappes de Processus avec arcs neutralisants.
  \begin{itemize}
    \item $\PHs' = \PHs \cup \PHs'_{\srsymbol} \cup \PHs'^A_{\scfsymbol} \cup
      \PHs'^B_{\scfsymbol} \cup \{ \srg \}$ où :
      \begin{itemize}
        \item $\PHssr = \{ \sr{h} \mid h \in \PHh \}$,
        \item $\PHsscfa = \{ \scf{A} \mid \exists h \in \PHh, A = \hitter{h} \}$,
        \item $\PHsscfb = \{ \scf{A \recouvre B} \mid
          \exists h \in \PHh, h = \PHfrappemult{A}{B} \}$ ;
      \end{itemize}
    \item $\PHl' = \PHl \times
      \left( \bigtimes{\sr{h} \in \PHssr} \PHl_{\sr{h}} \right) \times
      \left( \bigtimes{\scfa \in \PHsscfa} \PHl_{\scfa} \right) \times
      \left( \bigtimes{\scfb \in \PHsscfa} \PHl_{\scfb} \right) \times
      \PHl_\srg$ où :
      \begin{itemize}
        \item $\forall \sr{h} \in \PHssr, \PHl_{\sr{h}} = \{ \sr{h}_0, \sr{h}_1 \}$,
        \item $\forall \scfa \in \PHsscfa, \PHl_{\scfa} = \makesc{\scfa}$,
          %\{ \scfa_\mysigma \mid
          %\mysigma \in \PHsubl_{\sort{A}} \}$,
        \item $\forall \scfb \in \PHsscfb, \PHl_{\scfb} = \makesc{\scfb}$,
          %\{ \scfb_\mysigma \mid
          %\mysigma \in \PHsubl_{\sort{A \recouvre B}} \}$,
        \item $\PHl_\srg = \makesc{\srg^{(\theta)}}$
          avec $\theta = \{ \sr{h}_0 \mid \sr{h} \in \PHssr \}$ ;
          %\{ \srg_\mypi \mid
          %\mypi \in \PHsubl_{\{ \sr{h}_1 \mid \sr{h} \in \PHssr \}} \}$ ;
      \end{itemize}
    \item $\PHh'^{(1)} = \PHhscfa \cup \PHhscfb$ où :
      \begin{itemize}
        \item $\PHhsr = \{ \PHfrappe{a_i}{\scfa_\mysigma}{\scfa_{\mysigma'}} \mid
          \exists h = \PHfrappemult{A}{B} \in \PHh \wedge
          \scfa \in \PHsscfa \wedge
          \scfa_\mysigma , \scfa_{\mysigma'} \in \PHl_{\scfa} \wedge
          a \in \sortes{A} \wedge a_i \in \PHl_a \wedge
          \PHget{\mysigma}{a} \neq a_i \wedge \mysigma' = \mysigma \recouvre a_i \}$,
        \item $\PHhscfb = \{ \PHfrappe{b_j}{\scfb_\mysigma}{\scfb_{\mysigma'}} \mid
          \exists h = \PHfrappemult{A}{B} \in \PHh \wedge
          \scfb \in \PHsscfb \wedge
          \scfb_\mysigma , \scfb_{\mysigma'} \in \PHl_{\scfb} \wedge
          b \in \sortes{A \recouvre B} \wedge b_j \in \PHl_b \wedge
          \PHget{\mysigma}{b} \neq b_j \wedge \mysigma' = \mysigma \recouvre b_j \}$;
      \end{itemize}
    \item $\PHh'^{(2)} = \PHhsr \cup \PHh'_R$ où :
      \begin{itemize}
        \item $\PHhsr = ...$
      \end{itemize}


  \end{itemize}
  \todo{Revoir traduction avec 3 classes de priorités (plus simple)}
\end{definition}
\end{comment}



\begin{definition}
\deflabel{phm2php}
  Soient $\PH = (\PHs; \PHl; \PHh)$ des Frappes de Processus avec actions plurielles,
  et $\phmtophp = (\PHs'; \PHl'; \PHh'^{\langle 4 \rangle})$
  leur traduction en Frappes de Processus avec $4$ classes de priorités, où :
  \begin{itemize}
    \item $\PHs' = \PHs \cup \{ \sr{h} \mid h \in \PHh \} \cup \{ \scf{h} \mid h \in \PHh \}$ ;
    \item $\PHl' = \PHl \times \left( \bigtimes{h \in \PHh} \PHl_{\sr{h}} \right)
      \times \left( \bigtimes{h \in \PHh} \PHl_{\scf{h}} \right)$, où :
      \begin{itemize}
        \item $\forall h \in \PHh, \PHl_{\sr{h}} = \{ \sr{h}_0 , \sr{h}_1 \}$,
        \item $\forall h \in \PHh, \PHl_{\scf{h}} = \{ \scf{h}_\mysigma \mid
          \mysigma \in \PHsubl_{\sortes{\frappeur{h}}} \}$ ;
      \end{itemize}
    \item $\PHh'^{\langle 4 \rangle} = ( \PHh'^{(1)} ; \PHh'^{(2)} ; \PHh'^{(3)} ; \PHh'^{(4)} )$, où :
      \begin{itemize}
        \item $\PHh'^{(1)} = \{ \PHhit{a_i}{\scf{h}_\mysigma}{\scf{h}_{\mysigma'}} \mid
          h \in \PHh \wedge a \in \sortes{\frappeur{h}} \wedge a_i \in \PHl_a \wedge
          \scf{h}_\mysigma , \scf{h}_{\mysigma'} \in \PHl_{\scf{h}} \wedge
          \PHget{\mysigma}{a} \neq a_i \wedge \mysigma' = \mysigma \Cap a_i \}$,
        \item $\PHh'^{(2)} = \{ \PHhit{\sr{h}_1}{b_j}{b_k} \mid
          h \in \PHh \wedge b \in \sortes{\bond{h}} \wedge b_j, b_k \in \PHl_b \wedge
          b_j \in \frappeur{h} \wedge b_k \in \cible{h} \}$,
        \item $\PHh'^{(3)} = \{ \PHhit{\sr{h}_1}{\sr{h}_1}{\sr{h}_0} \mid h \in \PHh \}$,
        \item $\PHh'^{(4)} = \{ \PHhit{\scf{h}_\mypi}{\sr{h}_0}{\sr{h}_1} \mid
          h \in \PHh \wedge \Feval{\Fopphm{h}}{\mypi} \}$.
      \end{itemize}
  \end{itemize}
  Pour tout état $s \in \PHl$ de $\PH$,
  on note $\tophp{s}$ l'état correspondant dans $\phmtophp$ :
  \begin{itemize}
    \item $\forall a \in \PHs, \PHget{\tophp{s}}{a} = \PHget{s}{a}$,
    \item $\forall h \in \PHh, \PHget{\tophp{s}}{\sr{h}} = \sr{h}_0$,
    \item $\forall h \in \PHh, \PHget{\tophp{s}}{\scf{h}} = \scf{h}_\mysigma$,
      tel que $\forall a \in \sortes{\frappeur{h}}, \PHget{\mysigma}{a} = \PHget{\tophp{s}}{a}$.
  \end{itemize}
  À l'inverse, pour tout état $s' \in \PHl'$ de $\phmtophp$,
  on note $\tophm{s'}$ l'état correspondant dans $\PH$ :
  $\forall a \in \PHs, \PHget{\tophm{s'}}{a} = \PHget{s'}{a}$.
\end{definition}

\begin{theorem}[$\PH \approx \phmtophp$]
\thmlabel{phmequivphp}
  \[\forall s_1, s_2 \in \PHl, s \PHtrans s' \Longleftrightarrow
    \tophp{s_1} \trans{\phmtophp} \tophp{s_2} \enspace.\]
\end{theorem}

\todo{Preuve}



